{% extends "@ZghFE/layout.html.twig" %}
{% block stylesheets %}
    {{ parent() }}
    {% stylesheets
        "bundles/zghfe/css/magicsuggest-1.3.1.css"
        "bundles/zghfe/plugins/select2-3.4.6/select2.css"
        filter="cssrewrite"
    %}
        <link rel="stylesheet" href="{{ asset_url }}" type="text/css" media="screen"/>
    {% endstylesheets %}
{% endblock stylesheets %}
{% block content %}
    <div class="container">
        <div class="row cover">
        <div class="photoCover"><img src="{{ asset(user.coverPhoto.getWebPath) }}"/></div>
        <div class="SVb"></div>
        <div class="media profilePic profile col-md-6 col-xs-10">
          <div class="imgProfile pull-left">
              {% if user.id == app.user.id %}
                  <button data-toggle="modal" data-target="#pp_modal" type="button" class="btn btn-primary btn-circle ch-pr">
                      <span class="glyphicon glyphicon-camera cam-post"></span>
                      {#<input type="file" class="glyphicon glyphicon-camera cam-post"/>#}
                  </button>
                  <div class="modal fade" id="pp_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                      <div class="modal-dialog">
                          <div class="modal-content">
                              <div class="modal-header modalHeader">
                                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                  <h4 class="modal-title" id="myModalLabel">Select profile photo</h4>
                              </div>
                              <form action="{{ url("zgh_fe.user_profile.picture.set", {"id": app.user.id}) }}" method="post" enctype="multipart/form-data">

                                  <div class="modal-body">
                                      <input name="picture" type="file"/>
                                  </div>
                                  <div class="modal-footer">
                                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                      <button type="submit" class="btn btn-primary">Save changes</button>
                                  </div>
                              </form>

                          </div>
                      </div>
                  </div>
              {% endif %}
            <a  class="pull-left img-circle fancyboxArrow fancybox" rel="profile"  href="#profile_pic_popup">
                <img alt="" src="{{ "ROLE_FACEBOOK" in user.roles ? 'https://graph.facebook.com/'~user.facebookId~'/picture?width=125&height=125' : asset(user.profilePhoto.getThumbWebPath) }}" class="media-object" >
            </a>
              <div id="profile_pic_popup" style="display: none;">
                  <img src="{{ "ROLE_FACEBOOK" in user.roles ? 'https://graph.facebook.com/'~user.facebookId~'/picture?width=500&height=500' : asset(user.profilePhoto.getWebPath) }}" alt="profile_photo" />
              </div>
          </div>
            <h3><a href="">{{ user.firstname }} {{ user.lastname }}</a></h3>

            {{ renderFollow(user) }}

            <button class="btn-Message  btn btn-primary " type="button">
                <span class="glyphicon glyphicon-envelope"></span>
            </button>
            <a href="{{ url("zgh_fe.user_profile.connections_partial", {id: user.id}) }}" class="boy"> <span class="glyphicon glyphicon-user glyphicon-user-boy"></span> {{ user.followees|length }} </a>
        </div>
            {% if user.id == app.user.id %}
                <button data-toggle="modal" data-target="#cp_modal" class="btn btn-default btn-wide  btn-cover" type="button">
                    <span class="glyphicon glyphicon-pencil"></span> Change Cover
                </button>
            {% endif %}
            <div class="modal fade cover_wrapper" id="cp_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="myModalLabel">Select cover photo</h4>
                        </div>
                        <form action="{{ url("zgh_fe.user_profile.cover.set", {"id": app.user.id}) }}" method="post" class="cover_form" enctype="multipart/form-data">

                            <div class="modal-body">
                                <input name="cover" type="file" class="cover_input"/>
                                <div id="testtt" class="cover_thumb"  width="540px" height="400px"  style=" position: relative;">
                                    <img src="{{ asset("bundles/zghfe/img/thumb.jpg") }}" width="100%" height="auto" alt="cover"/>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save changes</button>
                            </div>
                        </form>

                    </div>
                </div>
            </div>


        <div style="display: none;" class="col-md-6 col-sm-6 warning">
            <h3>Your picture is too tall or too wide.</h3>

            <p>Try to pick something closer to a square.</p>
        </div>
    </div>

        <div class="divider"></div>

        {% if user.id == app.user.id %}
            {% if app.user.showInterestNotification %}
                <div class="alert alert-success">
                    <p>You may need to add some interests to your profile. <a href="{{ url("zgh_fe.interest.get") }}">Click here</a></p>
                </div>
            {% endif %}
        {% endif %}

        {% set current_route = app.request.attributes.get("_route") %}
        {% set authorized = isVisitable(user) %}
        <!--Menu -->
        <div class="row">
            <div class="col-xs-12">
                <div class="btn-group btn-group-md btn-group-justified">
                    {% if "ROLE_CUSTOMER" in user.roles %}
                        {% if authorized %}
                            <a href="#" data-target_url="{{ url("zgh_fe.user_profile.main_partial", {'id': user.id}) }}" type="button"
                               class="tab btn btn-primary {{ "index" in current_route or "main" in current_route ? "active" : "" }}">Posts</a>

                            <a href="#" data-target_url="{{ url("zgh_fe.user_profile.wishlist_partial", {'id': user.id}) }}" type="button"
                               class="tab btn btn-primary {{ "wishlist" in current_route ? "active" : "" }}">Wishlist</a>

                            <a href="#" data-target_url="{{ url("zgh_fe.user_profile.photos_partial", {'id': user.id}) }}" type="button"
                               class="tab btn btn-primary {{ "photos" in current_route or "albums" in current_route ? "active" : "" }}">Photos</a>

                            <a href="#" data-target_url="{{ url("zgh_fe.user_profile.experiences_partial", {'id': user.id}) }}" type="button"
                               class="tab btn btn-primary {{ "experience" in current_route ? "active" : "" }}">Experiences</a>
                        {% endif %}
                    {% elseif "ROLE_VENDOR" in user.roles %}
                        <a href="#" data-target_url="{{ url("zgh_fe.user_profile.main_partial", {'id': user.id}) }}" type="button"
                           class="tab btn btn-primary {{ "index" in current_route or "main" in current_route ? "active" : "" }}">Posts</a>

                        <a href="#" data-target_url="{{ url("zgh_fe.user_profile.branches_partial", {'id': user.id}) }}" type="button"
                           class="tab btn btn-primary {{ "branch" in current_route ? "active" : "" }}">Branches</a>

                        <a href="#" data-target_url="{{ url("zgh_fe.user_profile.products_partial", {'id': user.id}) }}" type="button"
                           class="tab btn btn-primary {{ "product" in current_route ? "active" : "" }}">Products</a>

                        <a href="#" data-target_url="{{ url("zgh_fe.user_profile.photos_partial", {'id': user.id}) }}" type="button"
                           class="tab btn btn-primary {{ "photos" in current_route or "albums" in current_route ? "active" : "" }}">Photos</a>

                        <a href="#" data-target_url="{{ url("zgh_fe.user_profile.tips_partial", {'id': user.id}) }}" type="button"
                           class="tab btn btn-primary {{ "tip" in current_route ? "active" : "" }}">Tips</a>
                    {% endif %}
                        <a href="#" data-target_url="{{ url("zgh_fe.user_profile.connections_partial", {'id': user.id}) }}" type="button"
                           class="tab btn btn-primary {{ "connection" in current_route ? "active" : "" }}">Connections</a>

                </div>

            </div>
        </div>
        <!-- Menu End  -->

        <div class="divider"></div>
        <div class="row content_wrapper">

        {% block leftContent %}

            <div id="vendPosts">


                <!--End Compose Post -->

                <div class="divider"></div>
                <!--Posted -->
                <div class="col-md-7 col-sm-7">

                    <!--Compose Post -->
                    {% if user.id == app.user.id %}
                        {{ include("@ZghFE/Partial/post_form.html.twig", {"return_url": path("zgh_fe.user_profile.index", {"id": user.id} ) }) }}
                    {% endif %}

                    {% if authorized %}
                        {{ render_esi(controller("ZghFEBundle:Post:getOwnList", {"id": user.id})) }}
                    {% else %}
                        <p>Private account, You have to follow {{ user.firstname }} first.</p>
                    {% endif %}
                    <!--End Post Box-->


                </div>

                <div class="col-md-5 col-sm-5 hidden-xs">


                    <!-- Left side posts page -->
                    {{ render_esi(controller("ZghFEBundle:UserProfile:getAboutPartial", {"id": user.id})) }}



                </div>

                <!--End of Posted -->


            </div>


        {% endblock leftContent %}

        </div>

        {% block rightContent %}{% endblock rightContent %}

    </div>
{% endblock content %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        UrlContainer.aboutPartial = "{{ url("zgh_fe.user_profile.about_partial", {"id": app.user.id}) }}";
        UrlContainer.wishlistPartial = "{{ url("zgh_fe.wishlist_partial_content", {"id": user.id}) }}";
        UrlContainer.branchesList = "{{ url("zgh_fe.branches.list", {"id": user.id}) }}";
    </script>

    {% javascripts
        "bundles/zghfe/js/pages_logic/user_index.js"
        "bundles/zghfe/js/pages_logic/about.js"
        "bundles/zghfe/js/pages_logic/wishlist.js"
        "bundles/zghfe/js/pages_logic/partial/photosRefresher.js"
        "bundles/zghfe/js/pages_logic/photos.js"
        "bundles/zghfe/js/pages_logic/experiences.js"
        "bundles/zghfe/js/pages_logic/branches.js"
        "bundles/zghfe/js/pages_logic/products.js"
        "bundles/zghfe/js/custom.js"
    %}
        <script src="{{ asset_url }}" type="text/javascript"></script>
    {% endjavascripts %}
{% endblock javascripts %}
