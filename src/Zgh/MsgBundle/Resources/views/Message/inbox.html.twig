{% extends 'ZghMsgBundle::layout.html.twig' %}

{% block fos_message_content %}
    <div class="row">
        <div class="col-md-4 col-sm-5 hidden-xs sectionLeft">
            <h2>Messages</h2>

            <div id="scrol" class="sidebarMessage">
                {% for thread in threads %}
                    <div class="col-3 data-reacted thread" data-t_id="{{ thread.id }}">
                        <div class="profile  sm-img-post">
                            <a href="#" class="pull-left img-circle ">
                                <img alt="" src="{{ asset(thread.messages[0].sender.profilePhoto.getThumbWebPath()) }}"
                                     class="media-object img-responsive">
                            </a>
                            <h4><a href="">{{ thread.messages[thread.messages|length - 1].sender.fullname }}</a></h4>
                            <span class="date-time">{{ thread.messages[0].createdAt|date() }}</span>
                            {#{{ fos_message_nb_unread() }}#}
                            {% if zgh_nb_thread_unread_message(thread) != 0 %}
                            <button class="btn btn-danger btn-circle btnMessages msgNotifications pull-right"
                                    type="button">
                                <span class="">{{ zgh_nb_thread_unread_message(thread) }}</span>
                            </button>
                            {% endif %}
                            <div class="row btnMessages btnRemove" data-target="#deletePost_{{ thread.id }}" data-toggle="modal"><span
                                        class="glyphicon glyphicon-remove pull-right "></span></div>

                        </div>

                    </div>

                    <div id="deletePost_{{ thread.id }}" aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1"
                         class="modal fade in">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header modalHeader">
                                    <button type="button" class="close modalClose" data-dismiss="modal"
                                            aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id="myModalLabel">Delete Post</h4>
                                </div>
                                <form action="{{ url("fos_message_thread_delete", {"threadId": thread.id}) }}" method="post">
                                    <div class="modal-body">
                                        <p>Are you sure you want to delete this?</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-wide btn-primary" data-dismiss="modal">Cancel</button>
                                        <button type="submit" class="btn btn-wide btn-primary">Delete</button>
                                    </div>
                                </form>
                            </div>
                            <!-- /.modal-content -->
                        </div>
                        <!-- /.modal-dialog -->
                    </div>
                {% endfor %}
            </div>
            <!-- end of Sidebar Message -->
        </div>
        <!-- end of Section Left -->
        <div class="col-md-8 col-sm-7 ms-input-1 sectionRight">
            <button class="btn btn-default btn-wide pull-right" type="button" data-toggle="modal" data-target="#myModal">
                <span class="glyphicon glyphicon-envelope"></span> New Message
            </button>
            <div class=clearfix></div>
            <div class="listMessage">
            {#{{ include("@ZghMsg/Message/thread.html.twig", {"thread": threads[0]}) }}#}
            </div>
        </div>
        <!-- end of Section Right -->
    </div>
{% endblock %}

{% block modals %}
    <!-- Modal -->
    <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" class="modal fade in"
         id="myModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header modalHeader">
                    <button type="button" class="close modalClose" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">New Message</h4>
                </div>
                {{ form_start(new_form, {"action": url('fos_message_inbox'), "method" : "post"}) }}
                <div class="modal-body">
                    {{ form_widget(new_form.recipient, {"attr": {"class": "form-control"} }) }}
                    <br>
                    {{ form_widget(new_form.body, {"rows": "6" ,"attr":{"class":"form-control", "placeholder": "Write Message"} }) }}
                </div>
                <div class="modal-footer">
                    <input type="submit" class="btn btn-wide btn-primary" value="Send"/>

                </div>
                {{ form_rest(new_form) }}
                {{ form_end(new_form) }}

            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div><!-- /.modal -->
{% endblock modals %}
{% form_theme new_form with ["ThraceFormBundle:Form:fields.html.twig"] %}
